#!/usr/bin/env zsh
set -e

# Source logging (deployed by chezmoi before run_after scripts)
source "${HOME}/.config/zsh/00-logging.zsh"

# Determine brew path
if [[ -x "/opt/homebrew/bin/brew" ]]; then
  BREW="/opt/homebrew/bin/brew"
elif [[ -x "/home/linuxbrew/.linuxbrew/bin/brew" ]]; then
  BREW="/home/linuxbrew/.linuxbrew/bin/brew"
else
  info_log "brew" "Homebrew not found, skipping brew bundle"
  exit 0
fi

eval "$($BREW shellenv)"
info_log "brew" "Installing packages from Brewfile..."
brew bundle --file="$HOME/.config/brew/packages"
info_log "brew" "Brew bundle complete"
