# Traditional prefix (Ctrl+l) - kept for compatibility
unbind C-b
set -g prefix C-l
bind C-a send-prefix

# Caps Lock + key bindings (mapped to F-keys via Karabiner)
# Window management
bind -n F13 new-window -c "#{pane_current_path}"                    # Caps+c: new window
bind -n F14 next-window                                              # Caps+n: next window
bind -n F15 previous-window                                          # Caps+p: previous window
bind -n F20 choose-window                                            # Caps+w: choose window
bind -n C-F13 select-window -t :=1                                   # Caps+1: window 1
bind -n C-F14 select-window -t :=2                                   # Caps+2: window 2
bind -n C-F15 select-window -t :=3                                   # Caps+3: window 3
bind -n C-F16 select-window -t :=4                                   # Caps+4: window 4
bind -n C-F17 select-window -t :=5                                   # Caps+5: window 5
bind -n C-F18 select-window -t :=6                                   # Caps+6: window 6
bind -n C-F19 select-window -t :=7                                   # Caps+7: window 7
bind -n C-F20 select-window -t :=8                                   # Caps+8: window 8
bind -n C-F21 select-window -t :=9                                   # Caps+9: window 9

# Pane management
bind -n F16 select-pane -L                                           # Caps+h: left pane
bind -n F17 select-pane -D                                           # Caps+j: down pane
bind -n F18 select-pane -U                                           # Caps+k: up pane
bind -n F19 select-pane -R                                           # Caps+l: right pane
bind -n S-F15 split-window -h -p 40 -c "#{pane_current_path}"        # Caps+|: split horizontal
bind -n S-F16 split-window -v -p 40 -c "#{pane_current_path}"        # Caps+-: split vertical
bind -n F23 resize-pane -Z                                           # Caps+z: zoom pane
bind -n F24 confirm-before -p "kill-pane #P? (y/n)" kill-pane        # Caps+x: kill pane

# Session management
bind -n F22 detach-client                                            # Caps+d: detach
bind -n F21 choose-session                                           # Caps+s: choose session

# Copy mode
bind -n S-F14 copy-mode                                              # Caps+[: copy mode

# Misc
bind -n S-F13 source-file ~/.config/tmux/tmux.conf \; display-message "tmux reloaded"  # Caps+r: reload config

set -g mouse on
set-window-option -g mode-keys vi
set -g default-terminal "screen-256color"
set -g status-position top
set -g status-style "fg=color248,bg=color234"
set -g status-justify right
set -g status-right ""

set -g status-left-length 15
set -g status-interval 1

# Show only numbers
set -g window-status-format "#[bg=colour238,fg=white]  #I#F  "
set -g window-status-current-format "#[bg=colour31,fg=black,bold]  #I#F  "

# set -g status off

##### Disable titles / renaming #####
set -g automatic-rename off
set -g allow-rename off
set -g set-titles off

# Increase history limit
set -g history-limit 10000

# Start window and pane numbering at 1, not 0
set -g base-index 1
setw -g pane-base-index 1
# Split panes using | and - (and open in the same directory)
bind | split-window -h -p 40 -c "#{pane_current_path}"
bind - split-window -v -p 40 -c "#{pane_current_path}"
bind r source-file ~/.config/tmux/tmux.conf \; display-message "tmux reloaded"
unbind '"'
unbind %

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
# Navigate panes with Vim keys (h,j,k,l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
# Search console output/scrollback buffer with fzf and copy selection to clipboard
#bind h display-popup -E  "tmux capture-pane -p -S - | fzf --reverse | pbcopy"
bind h display-popup -E  "{{ .chezmoi.targetFile | dir }}/tmux-fzf-search.sh"

# C-k for nvim is being blocked
set -g terminal-features "alacritty:c-k"

# A simpler keybind to kill the current session and switch or create a new one.
bind-key X confirm-before -p "kill-session '#S'? (y/n)" "\
    kill-session \; \
    if-shell '[ -n \"$(tmux list-sessions)\" ]' \
        'switch-client -l' \
        'new-session' \
"
# Copy mode + Mouse != scroll to output automatically (sometimes u select the wrong thing and it is annoying, to scroll to cmd use 'q')
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection
