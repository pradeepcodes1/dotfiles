# Config edit environment
# Launches a nix shell for editing chezmoi configuration

config-apply() {
  local chezmoi_source="{{ .chezmoi.sourceDir }}"
  "${chezmoi_source}/bootstrap.sh" "$@"
}

config-edit() {
  local chezmoi_source="{{ .chezmoi.sourceDir }}"
  local config_dev_flake="${chezmoi_source}/nix/config_dev"

  if [[ ! -d "$chezmoi_source" ]]; then
    error_log "config-edit" "Chezmoi source directory not found at $chezmoi_source"
    return 1
  fi

  if [[ ! -f "${config_dev_flake}/flake.nix" ]]; then
    error_log "config-edit" "config_dev flake not found at $config_dev_flake"
    return 1
  fi

  info_log "config-edit" "Launching config edit environment..."
  info_log "config-edit" "Working directory: $chezmoi_source"
  echo ""
  echo "Available commands:"
  echo "  - Edit files directly in this directory"
  echo "  - Run './bootstrap.sh' to apply changes"
  echo "  - Run 'chezmoi diff' to see what would change"
  echo "  - Run 'chezmoi status' to check file status"
  echo "  - Use 'git' for version control"
  echo "  - Type 'exit' to leave the config edit environment"
  echo ""

  # Launch nix shell with config_dev tools, cd to chezmoi source
  cd "$chezmoi_source"
  exec nix shell "$config_dev_flake" --command zsh
}
